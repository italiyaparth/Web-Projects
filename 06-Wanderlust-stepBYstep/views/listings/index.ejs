<!-- Step 9 Using ejs-mate ( commented part ) -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wanderlust</title>
</head> -->


<!-- Step 9 - except for body all other code is in boilerplate -->
<% layout("/layouts/boilerplate") %>


<body>
    
    <!-- <h3 class="mt-3">All Listings</h3> -->

    <!-- Step 6, then Step 10 ( moved to navbar.ejs, so commented out ) -->
    <!-- <form action="/listings/new" method="get">
        <button>Create New Listing</button>
    </form> -->

    <!-- Step 53 -->
    <form id="filterForm" action="/listings" method="get">

        <div id="filters">

            <div class="filter">
                <input type="checkbox" class="btn-check" name="filter" value="mountains" id="mountains" autocomplete="off">
                <label class="label-filter" for="mountains">
                    <i class="fa-solid fa-mountain-city"></i>
                    <p>Mountains</p>
                </label>
            </div>
    
    
            <div class="filter">
                <input type="checkbox" class="btn-check" name="filter" value="castles" id="castles" autocomplete="off">
                <label class="label-filter" for="castles">
                    <i class="fa-brands fa-fort-awesome"></i>
                    <p>Castles</p>
                </label>
            </div>
    
            <div class="filter">
                <input type="checkbox" class="btn-check" name="filter" value="farms" id="farms" autocomplete="off">
                <label class="label-filter" for="farms">
                    <i class="fa-solid fa-cow"></i>
                    <p>Farms</p>
                </label>
            </div>
    
            <div class="filter">
                <input type="checkbox" class="btn-check" name="filter" value="cabins" id="cabins" autocomplete="off">
                <label class="label-filter" for="cabins">
                    <i class="fa-solid fa-house"></i>
                    <p>Cabins</p>
                </label>
            </div>
    
            <div class="filter">
                <input type="checkbox" class="btn-check" name="filter" value="beach" id="beach" autocomplete="off">
                <label class="label-filter" for="beach">
                    <i class="fa-solid fa-person-swimming"></i>
                    <p>Beach</p>
                </label>
            </div>

        </div>

    </form>



    <!-- Step 12 -->
    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 row-cols-xs-1 mt-3">
        
        <% for (const listing of allListings) { %>

            <a href="/listings/<%= listing._id %>" class="listing-link">

                <div class="card listing-card">
                    <img class="card-img-top" src="<%= listing.image.url %>" alt="listing_image" style="height: 20rem;">
                    
                    <div class="card-img-overlay"></div> <!-- for card hover effect see style.css -->

                    <div class="card-body">
                        <p class="card-text">
                            <b><%= listing.title %></b> <br>
                            &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
                        </p>
                    </div>
                </div>
                
            </a>

        <% } %>

    </div>

    <!-- Step 4 -->
    <!-- <ul>
        <% for (const listing of allListings) { %>
            <li>
                <a href="/listings/<%= listing._id %>"><%= listing.title %></a>
            </li>
        <% } %>
    </ul> -->

    <script>

        let filterForm = document.getElementById("filterForm");
        const checkboxes = document.querySelectorAll('input[name=filter]');
        let filterArray = [];
        
        checkboxes.forEach((checkbox) => {
            checkbox.addEventListener("change", function () {

                if (this.checked) {
        
                    filterArray.push(this.value);
                    this.parentElement.classList.add("filter-clicked");
                    
                } else {
                    filterArray = filterArray.filter( (element) => element !== this.value);
                    this.parentElement.classList.remove("filter-clicked");
                }

                console.log(filterArray);
                filterForm.submit();
            });
        });
        
    </script>


</body>

<!-- Step 9 -->
<!-- </html> -->